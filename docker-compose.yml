services:
  proxy-pool:
    build:
      context: .
      dockerfile: Dockerfile
    image: proxy-pool:local
    container_name: proxy-pool
    # WebUI 会写入 config.yaml / nodes.txt（例如保存订阅链接、探测目标等）。
    # 在 Docker 场景下，这两个文件通常来自宿主机挂载，默认属于 root，非 root 用户会写入失败。
    # 为了开箱即用，默认以 root 运行；如果你希望以非 root 运行，请确保宿主机文件可写并移除此行。
    user: "0:0"
    restart: unless-stopped
    # 方式一：使用主机网络模式（推荐，支持端口自动重分配）
    network_mode: host
    # 方式二：手动映射端口（注释掉 network_mode，启用下面的 ports）
    # ports:
    #   # Pool 模式入口（pool/hybrid 模式使用）
    #   - "2323:2323"
    #   # Web 监控面板
    #   - "9090:9090"
    #   # Multi-port 端口范围（multi-port/hybrid 模式使用，根据节点数量调整）
    #   - "24000-24200:24000-24200"
    #
    # 支持的运行模式（在 config.yaml 中配置）：
    #   - pool: 单端口代理池，所有节点共享 2323 端口
    #   - multi-port: 多端口模式，每个节点独立端口
    #   - hybrid: 混合模式，同时启用 pool (2323) + multi-port (24000+)
    #
    # hybrid 模式说明：
    #   - 代理池入口：http://0.0.0.0:2323（自动负载均衡）
    #   - 独立节点入口：http://0.0.0.0:24000, 24001, ...（直连特定节点）
    #   - 节点状态在两种入口间共享（黑名单同步）
    #   - 端口冲突时自动重分配到下一个可用端口
    volumes:
      # 配置文件需要可写权限以支持 WebUI 设置保存
      # 如遇权限问题，请在宿主机执行: chmod 666 config.yaml nodes.txt
      - ./config.yaml:/etc/easy-proxies/config.yaml
      - ./nodes.txt:/etc/easy-proxies/nodes.txt
